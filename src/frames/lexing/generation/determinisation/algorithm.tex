% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin
% Part: 
% Section: 
% Sub-section: 
% Frame: 

\begingroup

\SetKwFunction{RabinScott}{rabin\_scott}
\SetKwFunction{Fermeture}{$\varepsilon$-fermeture}

\begin{frame}{Méthode des sous-ensembles de Rabin et Scott}

  \tfExampleBlock[right=3.3cm, top=-5mm]{Exemple}{\vspace{-3mm}\scriptsize
    \begin{tikzpicture}[smAutomaton, node distance=1cm]
      \smState[\smInitial                 \smExample<2-4|handout>] (0) at (0.0,1.2) {$0$};
      \smState[\smAccepting\smAlert<5>                           ] (1) at (1.2,1.2) {$1$};
      \smState[                                                  ] (2) at (2.4,1.2) {$2$};
      \smState[\smInitial                 \smExample<2-4|handout>] (3) at (0.0,0.0) {$3$};
      \smState[            \smStructure<2|handout>\smExample<3-4>] (4) at (1.2,0.0) {$4$};
      \smState[            \smStructure<2|handout>\smExample<3-4>] (5) at (2.4,0.0) {$5$};
      
      \smPath[\smStructure<2|handout>  ] (3) edge             node {$\varepsilon$} (4);
      \smPath[\smStructure<2,4|handout>] (4) edge             node {$\varepsilon$} (5);
      \smPath[                         ] (2) edge             node {$b$}           (1);
      \smPath[\smAlert<3>              ] (5) edge[bend left ] node {$a$}           (2);
      \smPath[                         ] (2) edge[bend left ] node {$a$}           (5);
      \smPath[\smAlert<4>              ] (4) edge[bend left ] node {$b$}           (1);
      \smPath[                         ] (1) edge[bend left ] node {$b$}           (4);
      \smPath[                         ] (1) edge[loop above] node {$a$}           (1);
      \smPath[                         ] (2) edge[loop above] node {$b$}           (2);
      \smPath[\smAlert<4>              ] (4) edge[loop below] node {$b$}           (4);
      \smPath[\smAlert<3>              ] (5) edge[loop below] node {$a$}           (5);
    \end{tikzpicture}
  }

  \tfExampleBlock<2-|handout>[right=3.3cm,y=-1mm]{Calcul de $s_0$}{
    $\begin{array}{r@{\,=\,}l}
      s_0 & \Fermeture_A(\{0,3\}) \\
          & \{\example{0}, \example{3}, \structure{4}, \structure{5}\}
    \end{array}$
  }  
  
  \tf[top=-2mm]{\small
    \begin{algorithm}[H]
      \Fn{\RabinScott($A = \langle \Sigma, Q, I, F, \rightarrow \rangle$ : AFN) : AFD}{
        $\begin{array}{@{}l@{\,\gets\,}l@{}}
          s_0 & \tfExample<2>{\Fermeture_A(I)};\\
          S & \{s_0\};\\
          \tau & \emptyset;
        \end{array}$\\
        \Tantque{\tfAlert<3,4>{$\exists s\in S, \exists a\in \Sigma, \nexists s'\in S,~ \langle s, a, s' \rangle \in \tau$}}{
          $\begin{array}{@{}l@{\,\gets\,}l@{}}
            s' & \tfStructure<4>{\Fermeture_A(\{q'\in Q \mid \exists q\in s,~ q \xrightarrow{a} q' \})};\\
            S & S \cup \{s'\};\\
            \tau & \tau \cup \{\langle s, a, s' \rangle\};
          \end{array}$\\
        }
        $S_f \gets \tfAlert<5>{\{s \in S \mid s \cap F \neq \emptyset\}}$\;
        \Retourner $\langle \Sigma, S, \{s_0\}, S_f, \tau \rangle$\;
      }
      \Fn{$\Fermeture_A(s \subseteq Q) \subseteq Q$}{
        \lTantque{\tfStructure<2>{$\exists q\in s,~ \exists q' \notin s,~ q\xrightarrow{\varepsilon} q'$}}{$s \gets s \cup \{q'\}$}
        \Retourner $s$\;
      }
    \end{algorithm}
  }

  \tf<2-|handout>[bottom=-4mm, x=-33mm] {\scriptsize
    \begin{tikzpicture}[smAutomaton]
      \draw[white] (-.5,-.5) -- (5.5,2.5);
      
      \smState            [\smInitial             ] (a) at (0.4,1.0) {$s_0$}; 
      \smState<4-|handout>[                       ] (b) at (1.2,1.8) {$s_1$}; 
      \smState<5-|handout>[\smAccepting\smAlert<5>] (c) at (1.2,0.2) {$s_2$}; 
      \smState<6-|handout>[\smAccepting           ] (d) at (3.8,1.8) {$s_3$}; 
      \smState<6-|handout>[\smAccepting           ] (e) at (3.8,0.2) {$s_4$}; 
      \smState<6-|handout>[\smAccepting           ] (f) at (3.0,1.0) {$s_5$};
      \smState<6-|handout>[\smAccepting           ] (g) at (4.6,1.0) {$s_6$}; 
      \smState<6-|handout>[                       ] (h) at (2.0,1.0) {$s_7$}; 

      \only<3,4>{
        \smState[\smAlert] (empty) at (2,1) {?};
        \smPath<3>[\smAlert] (a) edge node {$a$} (empty);
        \smPath<4>[\smAlert] (a) edge node {$b$} (empty);
      }

      \smPath<4-|handout> (a) edge[bend left ] node[swap] {$a$} (b);
      \smPath<5-|handout> (a) edge[bend right] node       {$b$} (c);
      \smPath<6-|handout> (b) edge[loop above] node       {$a$} (b);
      \smPath<6-|handout> (b) edge             node       {$b$} (d);
      \smPath<6-|handout> (c) edge             node       {$a$} (e);
      \smPath<6-|handout> (c) edge[loop below] node       {$b$} (c);
      \smPath<6-|handout> (d) edge[bend right] node       {$a$} (f);
      \smPath<6-|handout> (d) edge[bend left ] node[swap] {$b$} (g);
      \smPath<6-|handout> (e) edge[loop below] node       {$a$} (e);
      \smPath<6-|handout> (e) edge[bend right] node[swap] {$b$} (g);
      \smPath<6-|handout> (f) edge[bend right] node       {$a$} (e);
      \smPath<6-|handout> (f) edge             node[swap] {$b$} (h);
      \smPath<6-|handout> (g) edge[bend right] node[swap] {$a$} (e);
      \smPath<6-|handout> (g) edge[loop right] node       {$b$} (g);
      \smPath<6-|handout> (h) edge[bend right] node       {$a$} (b);
      \smPath<6-|handout> (h) edge[bend left ] node[swap] {$b$} (c);
    \end{tikzpicture}
  }
  
  \tf<2-|handout>[bottom, x=.27\textwidth]{\footnotesize
    \begin{tabular}{|l|l|l|}
      \hline
      &
      \multicolumn{2}{c|}{\rule{0pt}{1em}\structure{\textbf{Entrées de $\Sigma$}}}\\
      \hline
      \rule{0pt}{1.1em}\structure{\textbf{\'Etats de $S$}} &
      \multicolumn{1}{c|}{$\structure{a}$} &
      \multicolumn{1}{c|}{$\structure{b}$} \\
      \hline
      \rule{0pt}{1em}$s_0=\{\example<2>{0},\example<2>{3},\structure<2>{4},\structure<2>{5}\}$ \hspace\fill\structure{i}  &
      \only<3>{\alert{?}}\only<4-|handout> {$s_1=\{5, 2\}$} &
      \only<4> {\alert{?}}\only<5-|handout> {$s_2=\{1,4,5\}$} \\
      \uncover<4-|handout>{$s_1=\{5, 2\}$} &
      \uncover<6-|handout>{$s_1=\{5, 2\}$} &
      \uncover<6-|handout>{$s_3=\{1, 2\}$} \\
      \uncover<5-|handout>{$s_2=\{\alert<5>{1},4,5\}$ \hspace\fill\structure{f}} &
      \uncover<6-|handout>{$s_4=\{1,2,5\}$} &
      \uncover<6-|handout>{$s_2=\{1,4,5\}$} \\
      \uncover<6-|handout>{$s_3=\{1,2\}$ \hspace\fill\structure{f}} &
      \uncover<6-|handout>{$s_5=\{1,5\}$} &
      \uncover<6-|handout>{$s_6=\{1,2,4,5\}$} \\
      \uncover<6-|handout>{$s_4=\{1,2,5\}$ \hspace\fill\structure{f}} &
      \uncover<6-|handout>{$s_4=\{1,2,5\}$} &
      \uncover<6-|handout>{$s_6=\{1,2,4,5\}$} \\
      \uncover<6-|handout>{$s_5=\{1,5\}$ \hspace\fill\structure{f}} &
      \uncover<6-|handout>{$s_4=\{1,2,5\}$} &
      \uncover<6-|handout>{$s_7=\{4,5\}$} \\
      \uncover<6-|handout>{$s_6=\{1,2,4,5\}$ \hspace\fill\structure{f}} &
      \uncover<6-|handout>{$s_4=\{1,2,5\}$} &
      \uncover<6-|handout>{$s_6=\{1,2,4,5\}$} \\
      \uncover<6-|handout>{$s_7=\{4,5\}$} &
      \uncover<6-|handout>{$s_1=\{5,2\}$} &
      \uncover<6-|handout>{$s_2=\{1,4,5\}$} \\
      \hline
    \end{tabular}
  }
 
\end{frame}

\endgroup
